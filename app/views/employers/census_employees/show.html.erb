<% content_for :navigation do %>
<%= render :partial => 'employers/employer_profiles/primary_nav', :locals => {:active_tab=>params[:tab]} %>
<% end %>
<% dependents = @census_employee.try(:employee_role).try(:person).try(:primary_family).try(:active_family_members) || @census_employee.census_dependents %>
<% address =  @census_employee.try(:employee_role).try(:person).try(:addresses).try(:last) || @census_employee.address %>
<div id="add_employee_action">
  <div class="col-xs-12">
    <h1>Census Employee Details</h1>
    <div class="row">
      <div class="col-xs-6">
        <h4><%= name_to_listing(@census_employee) %>'s Details</h4>
        <div class="form-border">
          <p>
            Name: <%= name_to_listing(@census_employee) %><br/>
            DOB:  <%= format_date @census_employee.dob %><br/>
            SSN: <%= number_to_obscured_ssn @census_employee.ssn %><br/>
            Hired On: <%= format_date @census_employee.hired_on %><br/>
            Date Added to Roster: <%= format_date @census_employee.created_at %><br/>
            Owner: <%= @census_employee.try(:is_business_owner) ? "Yes" : "No" %><br/>
            <%if  @census_employee.coverage_terminated_on %>
            Plan End Date: <%= @census_employee.coverage_terminated_on %><br/>
            Employee Termination Date: <%= @census_employee.employment_terminated_on%>
            <%end%>
          </p>
        </div>
      </div>

      <% if address.present? %>
        <div class="col-xs-6">
          <h4>Address</h4>
          <div class="form-border">
            <%= address.to_html %>
          </div>
        </div>
      <% end %>

    </div>
    <% if @hbx_enrollments.present? %>
    <div class="row">
      <div class="col-xs-6">
        <% health_coverage = @hbx_enrollments.detect{|enrollment| enrollment.coverage_kind == 'health'} %>
        <%= render 'enrollment_details', enrollment: health_coverage if health_coverage %>
      </div>
      <div class="col-xs-6">
        <% dental_coverage = @hbx_enrollments.detect{|enrollment| enrollment.coverage_kind == 'dental'} %>
        <%= render 'enrollment_details', enrollment: dental_coverage if dental_coverage %>
      </div>
    </div>
    <% end %>
    <div class="row">
      <div class="col-xs-6">
        <h4>Dependents</h4>
        <div class="form-border">
          <% if dependents.present? %>
          <table style='width:100%;'>

            <% dependents.each do |dependent|
              relationship = dependent.try(:relationship) || dependent.try(:employee_relationship)
              if relationship == "self"%>
            <% else %>
              <tr>
                <th>Name</th>
                <th>DOB</th>
                <th>Relationship</th>
                <th>Gender</th>
              </tr>
            <tr>
              <td>
                <%= dependent.first_name + " " + dependent.last_name %>
              </td>
              <td>
                <%= format_date dependent.dob %>
              </td>
              <td>
                <%= relationship == "child_under_26" ? "child" : relationship %>
              </td>
              <td>
                <%= dependent.gender %>
              </td>
            </tr>
            <% end %>
            <% end %>
          </table>

          <% else %>
            <h4>You currently have no dependents.</h4>
          <% end %>
        </div>
      </div>
    </div>

    <div class="col-xs-12 row">
      <br/>
      <%= link_to '<i class="fa fa-chevron-left"></i> Back'.html_safe, employers_employer_profile_path(@employer_profile.id, :tab=>'employees'), class: 'btn btn-default return_to_employee_roster', "aria-expanded" => "true" %>
      <%if @census_employee.aasm_state == "employment_terminated" %>
          <a class="show_confirm btn btn-primary" id="show_confirm_<%= @census_employee.id %>">
              <span class="hidden-xs hidden-sm visible-md visible-lg" onclick="$('.cobra_confirm_<%= @census_employee.id %>').toggle();">COBRA</span>
            </a>
      <%end%>
      <% if @census_employee.aasm_state == 'employment_terminated' %>
            <a class="show_confirm btn btn-primary" id="show_confirm_<%= @census_employee.id %>">
              <span  class="hidden-xs hidden-sm visible-md visible-lg" onclick="$('.rehire_<%= @census_employee.id %>').toggle();">Rehire</span>
            </a>
      <%end%>
      <div class="unbrd cobra_confirm cobra_confirm_<%= @census_employee.id %> dn">
          <span class="confirm-terminate-wrapper">
            <span>Employment Termination Date: </span>
            <span><%= format_date @census_employee.employment_terminated_on %></span>
          </span>
          <span class="confirm-cobra-wrapper" id="enter-date">
            <%=cobra_effective_date(@census_employee) %>
          </span>
         <span>
            <a class="btn btn-default cobra_confirm_submit" data-link="<%= employers_employer_profile_census_employee_cobra_path(@employer_profile.id,@census_employee.id) %>" href="javascript:;" id="cobra_<%= @census_employee.id %>">
              <strong>&nbsp;Submit</strong>
            </a>
        </span>
        </div>
      <% if @census_employee.aasm_state == 'employment_terminated' %>
        <div class="unbrd  rehire_<%= @census_employee.id %> dn">
          <div class="confirm-terminate-wrapper show_confirm_<%= @census_employee.id %>" colspan="11" id="enter-date">
            <span><%=image_tag "enter_rehire_date.png", alt: "Enter re-hire date.", width: "200", height: "" %></span>
            <span class="confirm-terminate" style="display:inline;">
              <input class="text-center date-picker" data-date-min="<%= rehire_date_min(@census_employee) %>d" placeholder="e.g. 5/1/2015" type="text">
              <a class="btn btn-default rehire_confirm" data-link="<%= employers_employer_profile_census_employee_rehire_path(@employer_profile.id, @census_employee.id) %>" href="javascript:;" id="rehire_<%= @census_employee.id %>">
                <strong>&nbsp;Submit</strong>
              </a>
            </span>
          </div>
        </div> 
      <%end%>
    </div>
    </div>
    <span class="clear-fix">&nbsp;</span>
</div>
