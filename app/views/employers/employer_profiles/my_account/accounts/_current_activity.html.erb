<br>
<h4><strong> Recent Activity</strong></h4>
<br>
<table class="table">
  <thead>
    <tr>
      <th>Date</th>
      <th>Description</th>
      <th>Amount</th>
    </tr>
  </thead>
  <% if @employer_profile_account %>
  <tbody>
    <!-- Starting Balance -->
    <tr>
      <td><%= @employer_profile_account.current_statement_date %></td>
      <td>Amount due from <%= @employer_profile_account.current_statement_date %> invoice
        <i class="fa fa-info-circle" data-toggle="tooltip" data-placement="right" title="Amount Due is the total amount due on the last invoice.  Invoices must be paid in full or else the group is at risk of going into arrears.  Any payment or enrollment activity that occurs after the invoice date will be reflected on the next invoice."></i>
      </td>
      <td>
        <%= number_to_currency(@employer_profile_account.total_due) || "Data not available" %>
      </td>
    </tr>
    <!-- Payments -->
    <tr>
      <td class="payments-icon"><span class="pull-right glyphicon glyphicon-plus"></span></td>
      <td>Payments since <%= @employer_profile_account.try(:current_statement_date) %> invoice</td>
      <!-- <td><%= (@employer_profile.try(:employer_profile_account).try(:payments)) || "Data not available" %></td> -->
      <td></td>
    </tr>
    <% if @employer_profile_account.payments_since_last_invoice.size == 0 %>
    <tr class="payments">
      <td></td>
      <td>There have been no payments since the last invoice.</td>
      <td></td>
    </tr>
    <% else %>
      <% @employer_profile_account.payments_since_last_invoice.each do |payment| %>
        <tr class="payments">
          <td><%= payment.posting_date %></td>
          <% if payment.payment_method == "SCN" %>
            <td>Payment Type: CHK</td>
          <% else %>
            <td>Payment Type: <%= payment.payment_method %></td>
          <% end %>
          <td><%= number_to_currency(payment.amount) %></td>
        </tr>
      <% end %>
    <% end %>

    <!-- Adjustments/Enrollment Changes -->
    <tr>
      <td class="adjustments-icon"><span class="pull-right glyphicon glyphicon-plus"></span></td>
      <td>Enrollment changes since <%= @employer_profile_account.current_statement_date %> invoice
        <i class="fa fa-info-circle" data-toggle="tooltip" data-placement="right" title="Enrollment Changes are any type of enrollment change, including new enrollments, changes to existing enrollments, or terminations of coverage. Enrollment changes may occur due to a variety of reasons, including newly-eligible for coverage, special enrollment periods, or terminations of eligibility."></i>
      </td>
      <td></td>
    </tr>

    <% if @employer_profile_account.adjustments_since_last_invoice.size == 0 %>
    <tr class="adjustments">
      <td></td>
      <td>There have been no adjustments since the last invoice.</td>
      <td></td>
    </tr>
    <% else %>
      <% @employer_profile_account.adjustments_since_last_invoice.each do |adjustment| %>
        <tr class="adjustments">
          <td></td>
          <td><%= adjustment.name%> <%= adjustment.coverage_month.strftime("%m/%Y") %> coverage</td>
          <td><%= number_to_currency(adjustment.amount) %></td>
        </tr>
      <% end %>
    <% end %>

  </tbody>
  <% end %>

</table>

<!-- display payment history -->
<%= render partial: "employers/employer_profiles/my_account/accounts/payment_history" %>

<script>
  $(document).ready(function() {
    $('.payments').hide();
    $('.adjustments').hide();
  });


  $('td.payments-icon').click(function() {
    $(this).find('span').toggleClass('glyphicon-plus').toggleClass('glyphicon-minus');
    $('tr.payments').toggle();
  });

  $('td.adjustments-icon').click(function() {
    $(this).find('span').toggleClass('glyphicon-plus').toggleClass('glyphicon-minus');
    $('tr.adjustments').toggle();
  });
</script>
