<script
  src="https://apps.usw2.pure.cloud/widgets/9.0/cxbus.min.js"
  onload="javascript:CXBus.configure({debug:false,pluginsPath:'https://apps.usw2.pure.cloud/widgets/9.0/plugins/'}); CXBus.loadPlugin('widgets-core');"
></script>

<script>
  window._genesys = {
    widgets: {
      webchat: {
        transport: {
          type: 'purecloud-v2-sockets',
          dataURL: 'https://api.usw2.pure.cloud',
          deploymentKey: '<%= ENV['LIVE_CHAT_DEPLOY_KEY'] || '60b16add-5e86-4be1-86b4-c1e870cef2ed' %>',
          orgGuid: '72ccb33f-2747-4e02-aa7e-4030bdc11f13',
          interactionData: {
            routing: {
              targetType: 'QUEUE',
              targetAddress: '',
              priority: 2,
            },
          },
        },
        userData: {
          addressStreet: '',
          addressCity: '',
          addressPostalCode: '',
          addressState: '',
          phoneNumber: '',
          customField1Label: '',
          customField1: '',
          customField2Label: '',
          customField2: '',
          customField3Label: '',
          customField3: '',
        },
      },
    },
  };

  function getAdvancedConfig() {
    return {
      form: {
        autoSubmit: false,
        firstname: '',
        lastname: '',
        email: '',
        subject: '',
      },
      formJSON: {
        wrapper: '<table></table>',
        inputs: [
          {
            id: 'cx_webchat_form_firstname',
            name: 'firstname',
            maxlength: '100',
            placeholder: 'Required',
            label: 'First Name',
            validateWhileTyping: false, // default is false
            validate: function (
              event,
              form,
              input,
              label,
              $,
              CXBus,
              Common
            ) {
              if (input) {
                if (input.val()) return true;
                else return false;
              }
              return false;
            },
          },
          {
            id: 'cx_webchat_form_lastname',
            name: 'lastname',
            maxlength: '100',
            placeholder: 'Required',
            label: 'Last Name',
            validateWhileTyping: false, // default is false
            validate: function (
              event,
              form,
              input,
              label,
              $,
              CXBus,
              Common
            ) {
              if (input) {
                if (input.val()) return true;
                else return false;
              }
              return false;
            },
          },
          {
            id: 'cx_webchat_form_email',
            name: 'email',
            maxlength: '100',
            placeholder: 'Required',
            label: 'Email',
            validateWhileTyping: false, // default is false
            validate: function (
              event,
              form,
              input,
              label,
              $,
              CXBus,
              Common
            ) {
              if (input) {
                if (input.val()) return true;
                else return false;
              }
              return false;
            },
          },
          {
            id: 'cx_webchat_form_phoneNumber',
            name: 'phonenumber',
            maxlength: '100',
            placeholder: 'Optional',
            label: 'Phone Number',
          },
          {
            id: 'cx_webchat_form_coverMeID',
            name: 'coverMeID',
            maxlength: '100',
            placeholder: 'Optional',
            label: 'CoverME.gov ID',
          },
          {
            id: 'cx_webchat_form_customselect',
            name: 'customselect',
            placeholder: 'Required',
            label: 'Topic',
            type: 'select',
            required: 'Please select an option',
            options: [
              {
                text: 'Required',
                hidden: 'hidden',
                value: 'na',
              },
              {
                text: 'Manage my CoverME.gov Account',
                value: 'A',
              },
              {
                text: 'Open Enrollment & Eligibility',
                value: 'B',
              },
              {
                text: 'Documentation Questions',
                value: 'C',
              },
              {
                text: 'Special Enrollment Period (SEP)',
                value: 'D',
              },
            ],

            validate: function (
              event,
              form,
              input,
              label,
              $,
              CXBus,
              Common
            ) {
              if (input != undefined) {
                if (
                  document.getElementById('cx_webchat_form_customselect')
                    .value != 'na'
                )
                  return true;
                else return false;
              }
              return false;
            },
            wrapper:
              '<tr><th>{label}</th><td>{input}</td></tr>' /* input row wrapper */,
          },
        ],
      },
    };
  }

  const customPlugin = CXBus.registerPlugin('Custom');
</script>

<style>
  /* Primary Background */
  .cx-widget.cx-theme-dark {
    background-color: #2f5063;
  }  

  /* Fields Background (Form Input) */
  .cx-widget.cx-theme-dark .cx-form-control {
    background-color: #4b7ca4;
    color: #fdfdfd;
  }

  /* Start Button */
  .cx-widget.cx-theme-dark .cx-btn-primary {
    border-color: #8ba472 !important;
    background: #8ba472;
  }

  /* Cancel Button */
  .cx-widget.cx-theme-dark .cx-btn-default {
    border-color: #4b7ca4!important;
    background-color: #4b7ca4;
  }

  .live-chat-button {
    position: fixed;
    bottom: 5rem;
    right: 5rem;
    border-radius: 3px;
    background-color: #647F3A;
    font-family: Barlow, sans-serif;
    color: #fff;
    padding: 7px 11px;
    font-size: 16px;
    font-weight: 500;
    box-shadow: 0 3px 6px 0 rgba(0, 0, 0, 0.25);
    border: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }
</style>


<button class="live-chat-button" type="button" id="chat-button" onclick="customPlugin.command('WebChat.open', getAdvancedConfig());">

  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M13.25 14C12.0074 14 11 15.0074 11 16.25V17.752L11.0079 17.8604C11.3186 19.9866 13.2285 21.009 16.4332 21.009C19.6264 21.009 21.5667 19.9983 21.9855 17.8966L22 17.75V16.25C22 15.0074 20.9926 14 19.75 14H13.25ZM16.5 6C14.567 6 13 7.567 13 9.5C13 11.433 14.567 13 16.5 13C18.433 13 20 11.433 20 9.5C20 7.567 18.433 6 16.5 6Z" fill="white"/>
    <path d="M13.25 14C12.0074 14 11 15.0074 11 16.25V17.752L11.0079 17.8604C11.3186 19.9866 13.2285 21.009 16.4332 21.009C19.6264 21.009 21.5667 19.9983 21.9855 17.8966L22 17.75V16.25C22 15.0074 20.9926 14 19.75 14H13.25ZM13.25 15.5H19.75C20.1642 15.5 20.5 15.8358 20.5 16.25V17.6704C20.2202 18.8708 18.9494 19.509 16.4332 19.509C13.9171 19.509 12.7034 18.8777 12.5 17.6932V16.25C12.5 15.8358 12.8358 15.5 13.25 15.5ZM16.5 6C14.567 6 13 7.567 13 9.5C13 11.433 14.567 13 16.5 13C18.433 13 20 11.433 20 9.5C20 7.567 18.433 6 16.5 6ZM4.25 2C3.00736 2 2 3.00736 2 4.25V7.75C2 8.99264 3.00736 10 4.25 10H5.7049L7.87145 12.1414C8.36253 12.6266 9.15397 12.6219 9.63918 12.1308C9.87036 11.8968 10 11.5812 10 11.2526L10.0006 9.9862C11.1253 9.86155 12 8.90792 12 7.75V4.25C12 3.00736 10.9926 2 9.75 2H4.25ZM16.5 7.5C17.6046 7.5 18.5 8.39543 18.5 9.5C18.5 10.6046 17.6046 11.5 16.5 11.5C15.3954 11.5 14.5 10.6046 14.5 9.5C14.5 8.39543 15.3954 7.5 16.5 7.5ZM4.25 3.5H9.75C10.1642 3.5 10.5 3.83579 10.5 4.25V7.75C10.5 8.16421 10.1642 8.5 9.75 8.5H8.50137L8.5003 10.6539L6.3211 8.5H4.25C3.83579 8.5 3.5 8.16421 3.5 7.75V4.25C3.5 3.83579 3.83579 3.5 4.25 3.5Z" fill="white"/>
  </svg>
  <%= l10n("live_chat") %>
</button>