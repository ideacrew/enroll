<% if @bs4 %>

<section id="add_health_coverage_card" class="my-4 p-3 border rounded bg-white">
  <div class="d-flex flex-row justify-content-between align-items-center">
    <h3><%= l10n("faa.health_coverage.coverage_title", number:"1") %></h3>
    <a id="remove_income_type" class="btn outline button-error" href="#" data-target=""><%= l10n('faa.health_coverage.remove_income_type') %></a>
  </div>

  <div class="my-4">
    <label class="required" for="other_coverage_type"><%=l10n("faa.health_coverage.health_cov_type")%></label>

    <%# maybe move this to a helper? %>
    <% insurance_kind_options = [] %>
    <% insurance_kinds.each do |insurance_kind| %>
      <% eligible_esi = kind == "is_eligible" && insurance_kind == 'employer_sponsored_insurance' && FinancialAssistanceRegistry.feature_enabled?(:minimum_value_standard_question) %>
      <% term = eligible_esi ? "faa.question.#{insurance_kind}_eligible" : "faa.question.#{insurance_kind}" %>
      <% if I18n.exists?("glossary."+insurance_kind) %>
          <% hr_kind = render partial:'shared/glossary', locals: {key: insurance_kind, term: l10n(term, short_name: EnrollRegistry[:enroll_app].setting(:short_name).item) } %>
      <% else %>
          <% hr_kind = l10n(term, short_name: EnrollRegistry[:enroll_app].setting(:short_name).item) %>
      <% end %>
      <% insurance_kind_options << [ hr_kind, insurance_kind ] %>
    <% end %>

    <%= select_tag :insurance_kinds_select, options_for_select(insurance_kind_options), required:true, class: "focus col-12" %>
  </div>

  <div class="d-flex flex-column">
    <%= l10n("faa.health_coverage.coverage_period_question") %>

    <div class="d-flex mt-3">
      <div class="d-flex flex-column mr-3">
        <label class="required" for="coverage_date_start"><%=l10n("start_date")%></label>
        <%= date_field :coverage_date_start, {id: "coverage_date_start", class: "date-field col-3 mt-3"} %>
      </div>

      <div class="d-flex flex-column">
        <label for="coverage_date_end"><%=l10n("end_date")%></label>
        <%= date_field :coverage_date_end, {id: "coverage_date_end", class: "date-field col-3 mt-3"} %>
      </div>
    </div>
  </div>
</section>

<button tabindex="0" onkeydown="handleButtonKeyDown(event, 'add_new_insurance_kind')" id="add_new_insurance_kind" class="button secondary">
  <%= l10n("faa.health_coverage.add_cov_type") %>
</button>

<% else %>
  <div class="instruction-row row row-form-wrapper no-buffer row-height">
    <div class="col-md-10 checklist-title">
      <span> <b class="run-glossary"> <%= text1 %> <%= render partial: "shared/glossary", locals: { key: "coverage", title: "coverage", term: "coverage" } %> <%= text2 %> </b></span>
    </div>
  </div>
  <div class="instruction-row row row-form-wrapper lightgray no-buffer row-height">
    <div class="col-md-12 checklist-title-header">
      <span> <b> Check any boxes that apply to this person </b> and enter details when requested. </span>
    </div>
  </div>

  <br />
  <% insurance_kinds.each do |insurance_kind| %>
    <div id="<%= insurance_kind %>"class="benefit-kind">
      <div class="row row-form-wrapper radio-align fa-text-color lightgray no-buffer row-height">
        <div class="col-md-10 benefits-check <%= insurance_kind %>">
          <%= check_box_tag "insurance_kind", insurance_kind, @applicant.benefits.where(kind: kind).of_insurance_kind(insurance_kind).present?, class: "benefit-checkbox", data: {cuke: "#{insurance_kind}_benefit_checkbox"} %>
          <% eligible_esi = kind == "is_eligible" && insurance_kind == 'employer_sponsored_insurance' && FinancialAssistanceRegistry.feature_enabled?(:minimum_value_standard_question) %>
          <% term = eligible_esi ? "faa.question.#{insurance_kind}_eligible" : "faa.question.#{insurance_kind}" %>
          <% if I18n.exists?("glossary."+insurance_kind) %>
              <%= render partial:'shared/glossary', locals: {key: insurance_kind, term: l10n(term, short_name: EnrollRegistry[:enroll_app].setting(:short_name).item) } %>
          <% else %>
              <%= l10n(term, short_name: EnrollRegistry[:enroll_app].setting(:short_name).item) %>
          <% end %>
        </div>
      </div>

      <div class="benefits-list <%= kind %>">
        <% @applicant.benefits.where(kind: kind).of_insurance_kind(insurance_kind).each do |benefit| %>
          <% if display_esi_fields?(benefit.insurance_kind, kind) %>
            <%= render partial: 'esi_benefit', locals: { benefit: benefit, insurance_kind: insurance_kind, kind: kind } %>
          <% else %>
            <%= render partial: 'non_esi_benefit', locals: { benefit: benefit, insurance_kind: insurance_kind, kind: kind } %>
          <% end %>
        <% end %>
      </div>

      <div class='new-benefit-form hidden <%= insurance_kind %>'>
        <% if display_esi_fields?(insurance_kind, kind) %>
          <%= render partial: 'financial_assistance/benefits/esi_benefit_form', locals: { benefit: @applicant.benefits.build, insurance_kind: insurance_kind, kind: kind} %>
        <% else %>
          <%= render partial: 'financial_assistance/benefits/non_esi_benefit_form', locals: { benefit: @applicant.benefits.build, insurance_kind: insurance_kind, kind: kind} %>
        <% end %>
      </div>
      <div class="col-md-12 add-more-link-<%=insurance_kind%>" id="add-more-link">
        <a tabindex="0" onkeydown="handleButtonKeyDown(event, 'add_new_insurance_kind')" id="add_new_insurance_kind" class="<%= 'hidden' unless @applicant.benefits.where(kind: kind).of_insurance_kind(insurance_kind).present? %>">
          <span class="fa-icon fa-stack plus-mr" aria-hidden="true">
            <i class="fa fa-circle-thin fa-stack-2x"></i>
            <i class="fa fa-plus fa-stack-1x"></i>
          </span>
          <b> <%= l10n("add_more") %> </b> <%= l10n("faa.question.#{insurance_kind}", short_name: EnrollRegistry[:enroll_app].setting(:short_name).item) %>
        </a>
      </div>
    </div>
  <% end %>
<% end %>