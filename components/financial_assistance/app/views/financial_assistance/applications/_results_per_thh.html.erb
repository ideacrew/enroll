<h1><%= l10n("faa.eligibility_results") %></h1>
<div>
  <strong>Application Reference Id: <%= @application.hbx_id %></strong>
</div>

<% @application.eligibility_determinations.each_with_index do |ed, i| %>
  <% if @application.eligibility_determinations.length > 1 %>
    <h4><%= l10n("faa.results_hh_label") %> <%= i +1 %></h4>
  <% end %>

  <!-- This appears if at least some (not necessarily all) applicants are medicaid eligible -->
  <% if eligible_applicants(params[:id], :is_medicaid_chip_eligible).present? %>
    <div class="er-medicaid mt-20">
      <div class="er-title">
        <h3><%= l10n("faa.medicaid") %></h3>
      </div>
      <div class="border-bottom-2px"></div>
      <div class="er-medicaid-prsn">
        <p>
          <%= l10n("faa.eligible_for_medicaid") %>
          <%= render partial:'shared/glossary', locals: {key: 'medicaid', title: FinancialAssistanceRegistry[:medicaid_chip_driver_questions].setting(:medicaid_chip).item, term:  FinancialAssistanceRegistry[:medicaid_chip_driver_questions].setting(:medicaid_chip).item } %>
          <% if EnrollRegistry[:enroll_app].setting(:site_key).item == :me %>
            <%= l10n("faa.eligible_for_medicaid2") %>:
          <% else %>
            :
          <% end %>
        </p>
        <%eligible_applicants(params[:id], :is_medicaid_chip_eligible).each do |applicant_name| %>
        <div class='er-prsn'>
          <i class="fa fa-user fa-2x" aria-hidden="true"></i>
          <h4><%=applicant_name%></h4>
        </div>
        <%end%>
      </div>
    </div>
    <div class="border-bottom-1px"></div>
    <div class="er-warning bg-warning">
      <div><i class="fa fa-exclamation-triangle fa-lg text-warning" aria-hidden="true"></i></div>
      <div class="text-warning ">
        <%= l10n("faa.dhs_decision") %>
        <%= l10n("faa.dhs_contact") %><%= "#{EnrollRegistry[:enroll_app].setting(:medicaid_agency_phone).item} / TTY: 711." %>
      </div>
    </div>
  <% end %>
  <!-- Medicaid eligible ends here -->

  <!-- Appears if any are ia eligible -->
  <%if household_eligible_applicants(params[:id], :is_ia_eligible, ed.id).present?%>
    <div class="er-phi mt-20">
      <div class="er-title">
        <h3><%= l10n("faa.review_eligibility_header") %></h3>
      </div>
      <div class="border-bottom-2px"></div>
      <div class="er-medicaid-prsn">
        <% csr_73_87_or_94_applicants = csr_73_87_or_94_eligible_applicants?(params[:id]) %>
        <% csr_100_applicants = csr_100_eligible_applicants?(params[:id]) %>
        <% csr_limited_applicants = csr_limited_eligible_applicants?(params[:id]) %>
        <% total_aptc_amount = number_to_currency(ed.max_aptc&.to_f) %>
        <p><%= l10n("faa.premium_reductions_1", reduction_amount: total_aptc_amount.present? ? total_aptc_amount.to_s : "0") %></p>
        <% if csr_73_87_or_94_applicants.present? || csr_100_applicants.present? || csr_limited_applicants.present? %>
          <p class="csr-result"><%= l10n("faa.csr_73_87_or_94_results") %></p>
          <% if csr_100_applicants.present? %>
            <p class="mt-10 mb-0">
              <%= l10n("faa.qualify_for_lower_costs_1") %>
              <%= l10n("faa.qualify_for_csr_100") %>
            </p>
          <% end %>
          <% if csr_100_applicants.present? %>
            <p class="mt-10 mb-0">
              <%= l10n("faa.qualify_for_csr_limited") %>
            </p>
          <% end %>
        <% end %>

        <ul class="er-prsn mt-15">
        <% household_eligible_applicants(params[:id], :is_ia_eligible, ed.id).each do |applicant, csr| %>
            <!-- make the csr labels look like CSR-73, CSR-87, CSR-94, CSR-NA0 (100), CSR-NAL (Limited) (ignore (), just reference) !-->
            <li><strong><%= applicant %> <% if csr > 0 %>&mdash; <%= csr %>%<% end %></strong></li>
          <%end%>
        </ul>
      </div>
    </div>
  <% end %>
  <!-- End ia eligible stuff -->
      <!-- Totally ineligible -->
      <%if eligible_applicants(params[:id], :is_totally_ineligible).present?%>
        <div class="er-notqualify mt-20">
          <div class="er-title">
            <h3><%= l10n("faa.does_not_qualify") %></h3>
          </div>
          <div class="border-bottom-2px"></div>
          <div class="er-medicaid-prsn">
            <p> <%= l10n("faa.likely_does_not_qualify") %>
            <%= render partial:'shared/glossary', locals: {key: 'medicaid', title: FinancialAssistanceRegistry[:medicaid_chip_driver_questions].setting(:medicaid_chip).item, term:  FinancialAssistanceRegistry[:medicaid_chip_driver_questions].setting(:medicaid_chip).item } %>
            <%= l10n("faa.likely_does_not_qualify2") %></p>
            <%eligible_applicants(params[:id], :is_totally_ineligible).each do |applicant_name| %>
              <div class='er-prsn mb'>
                <i class="fa fa-user fa-2x" aria-hidden="true"></i>
                <h4><%=applicant_name%></h4>
              </div>
            <%end%>
          </div>
        </div>
      <%end%>
      <!-- End totally ineligible -->

      <%if eligible_applicants(params[:id], :is_without_assistance).present?%>
        <div class="er-notqualify mt-20">
          <div class="er-title">
            <h3><%= l10n("faa.private_health_insurance") %></h3>
          </div>
          <div class="border-bottom-2px"></div>
          <div class="er-medicaid-prsn">
            <p> <%= l10n("faa.qualified_to_enroll") %></p>
            <%eligible_applicants(params[:id], :is_without_assistance).each do |applicant_name| %>
              <div class='er-prsn mb'>
                <i class="fa fa-user fa-2x" aria-hidden="true"></i>
                <h4><%=applicant_name%></h4>
              </div>
            <%end%>

            </br>

            <%# For all eligible for limited %>
            <% csr_limited_applicants = csr_limited_eligible_applicants?(params[:id]) %>
            <% if csr_limited_applicants.present? %>
              <p class="mt-10 mb-0">
                <%= l10n("faa.qualify_for_csr_limited") %>
              </p>

              <% csr_limited_applicants.each do |applicant_name| %>
                <div class="er-prsn mt-15">
                  <i class="fa fa-user fa-2x" aria-hidden="true"></i>
                  <h4><%= applicant_name %></h4>
                </div>
              <% end %>
            <% end %>
          </div>
        </div>
      <%end%>

      <% if FinancialAssistanceRegistry.feature_enabled?(:non_magi_referral_display) && @application.applicants.pluck(:is_eligible_for_non_magi_reasons).any?(true) %>
        <div class="er-medicaid mt-20">
          <div class="er-title">
            <h3><%= l10n("faa.referral") %></h3>
          </div>
          <div class="border-bottom-2px"></div>
          <div class="er-medicaid-prsn">
            <p><%= l10n("faa.qualified_reason") %>:</p>

            <% @application.applicants.each do |applicant| %>
              <% if applicant.is_eligible_for_non_magi_reasons %>
                <div class='er-prsn'>
                  <i class="fa fa-user fa-2x" aria-hidden="true"></i>
                  <h4><%=applicant.full_name%></h4>
                </div>
              <%end%>
            <%end%>
          </div>
          <div class="border-bottom-1px"></div>
          <div class="er-warning bg-warning">
            <div><i class="fa fa-exclamation-triangle fa-lg text-warning" aria-hidden="true"></i></div>
            <div class="text-warning ">
              <%= l10n("faa.next_step_with_non_magi") %>
            </div>
          </div>
        </div>
      <%end%>
<% end %>